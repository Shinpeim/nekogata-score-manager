# 完了済みタスク

このファイルには完了したタスクの履歴を記録しています。

## 完了済み

### 2025-06-18: Google Drive同期機能完全実装
- [x] **複数環境でのスコア同期機能** (推定工数: 2-3週間)
  - [x] 基盤層実装
    - [x] Google API Console設定 (プロジェクト作成、OAuth 2.0設定) ※.env.exampleファイル作成済み
    - [x] 認証フロー実装 (GoogleAuthProvider、トークン管理)
    - [x] 同期アダプター層 (ISyncAdapter、GoogleDriveSyncAdapter)
  - [x] 同期ロジック実装
    - [x] タイムスタンプ管理 (lastSyncedAt、lastModifiedAt、deviceId)
    - [x] コンフリクト検出 (後勝ち戦略、警告表示)
    - [x] 同期実行フロー (pull → compare → warn → push)
  - [x] UI/UX実装
    - [x] 同期状態表示 (SyncStatusIndicator、最終同期時刻)
    - [x] コンフリクト警告ダイアログ (上書き前プレビュー、バックアップオプション)
    - [x] 設定画面 (同期有効/無効、アカウント連携状態、手動同期)
  - [x] エラーハンドリング・テスト
    - [x] ネットワーク/認証エラー対応、リトライ機構
    - [x] MockSyncAdapter実装、コンフリクトシナリオテスト
  - [x] ストア統合・実装完了
    - [x] ~~chordChartStoreへの同期機能統合~~ → **ストア分離対応済み** (PR#88)
      - [x] chordChartStore分離 (396行→256行)
      - [x] syncStore新規作成 (132行、19テスト)
      - [x] 責務分離による保守性向上
    - [x] **ストア間連携実装** (2024-12-16完了)
      - [x] SyncResult型にmergedChartsフィールド追加
      - [x] chordChartStoreにapplySyncedCharts()とイベント機能追加
      - [x] SyncManagerでmergedCharts返却対応
      - [x] useChartSyncカスタムフック作成（手動+自動同期）
    - [x] **残り実装タスク** 
      - [x] Header/MainLayoutへの同期UI追加  
      - [x] App.tsxでの同期初期化処理
      - [x] 初回認証フロー実装
      - [x] Google Drive API認証エラーの修正（フォルダ作成処理）

### 2025-01-15: コードメモ機能実装
- [x] コードそれぞれに自由記述の「メモ」を割り当て可能
- [x] 歌詞や演奏記号（クレッシェンド等）の記録
- [x] 表示時にコードネームの上にメモを表示
- [x] 編集モードでのメモ入力フィールド追加
- [x] テスト作成（SortableChordItem、ChordGridRenderer）
- [x] データモデルのChord.memo?プロパティ追加

## その他の完了済み
- [x] 技術スタックの決定 - フレームワーク、ビルドツール、UI ライブラリの選択
- [x] 開発用ブランチの作成
- [x] Vite + React + TypeScript プロジェクトの初期化
- [x] 必要な依存関係のインストール (Tailwind CSS, shadcn/ui, Zustand, localforage)
- [x] PWA設定の追加
- [x] プロジェクトが正常に起動するかテスト
- [x] メインレイアウトのデザイン（ヘッダー、サイドバー、メインコンテンツ）
- [x] 基本コンポーネントの作成（Header, Sidebar, ChordChart）
- [x] モバイルレスポンシブ対応
- [x] データ構造の設計 - コード譜データの形式定義
- [x] TypeScript型定義ファイルの作成 (src/types/chord.ts)
- [x] コア機能の実装 - コード譜の表示・編集機能
- [x] サンプルデータの作成 (sampleCharts.ts)
- [x] ChordChartコンポーネントの動的データ対応
- [x] MainLayoutのサイドバーでのコード譜一覧表示
- [x] Tailwind CSS PostCSS設定の修正
- [x] Tailwind CSS v4対応 - @import "tailwindcss"記法への変更
- [x] 8小節横並び表示レイアウトの実装
- [x] 楽譜風の罫線と小節線表示
- [x] 拍数に応じたコード配置レイアウト
- [x] コードネームサイズの最適化
- [x] 拍数表示の右付き配置
- [x] 状態管理の実装（Zustand使用）
- [x] アプリ起動時のサンプルデータ初期化
- [x] サイドバーでのコード譜選択機能
- [x] 現在選択中コード譜のハイライト表示
- [x] Zustand無限ループエラーの修正
- [x] コード譜の作成機能の実装
- [x] 新規作成フォームコンポーネント
- [x] 新規作成ボタンとモーダル表示
- [x] コード譜作成用ヘルパー関数
- [x] 基本情報入力（タイトル、アーティスト、キー、テンポ、拍子）
- [x] バリデーション機能
- [x] セクション未定義時のエラー修正
- [x] コード譜の編集機能の実装
- [x] ChordChartEditorコンポーネントの作成
- [x] 編集モード切り替え機能
- [x] セクション管理機能（追加・削除・編集）
- [x] コード入力・編集機能
- [x] コード譜の保存・読み込み機能（localforage使用）
- [x] 非同期ストア設計への移行
- [x] エラーハンドリングとローディング状態管理
- [x] 包括的テストスイートの追加（84テスト）
- [x] TypeScript型安全性の向上
- [x] 初期状態を空のコード譜に変更（サンプル楽譜を削除）
- [x] 空の状態でのUI/UX改善
- [x] 新規作成ボタンの統合と機能向上
- [x] 拍子に応じた小節拍数の修正（3/4拍子で3拍、4/4拍子で4拍など）
- [x] 拍子変更時の全セクション自動更新機能
- [x] コード表示幅の動的計算（拍子に応じた正しい幅表示）
- [x] 既存データの自動移行処理（LocalStorage対応）
- [x] コード譜のエクスポート・インポート機能（JSONフォーマット）
- [x] 単一・複数・全楽譜のエクスポート機能
- [x] JSONファイルからのインポート機能
- [x] データバリデーションとエラーハンドリング
- [x] 旧フォーマット自動変換機能
- [x] エクスポート・インポートUI（ダイアログ形式）
- [x] アプリケーション名をNekogata Score Managerに変更
- [x] Nekogata Score Manager用カスタムfaviconとPWAアイコンの作成
- [x] BPMの視覚的なインジケータの実装（点滅アニメーション）
- [x] 複数楽譜の一括削除・エクスポート機能の実装
- [x] チェックボックスによる複数選択機能の実装
- [x] 全選択/選択解除機能の実装
- [x] 確認ダイアログによる削除機能の実装
- [x] 選択された楽譜のエクスポート機能の実装
- [x] Score Explorer UI/UXの大幅改善
- [x] Gmail風一括選択チェックボックスの実装
- [x] プルダウン式アクションボタンの実装
- [x] Score Explorerの横幅拡張とレイアウト最適化
- [x] 複数楽譜削除時のlocalstorageエラーの修正（競合状態の解決）
- [x] インポート機能の改善（メタデータ保持の確保）
- [x] 小節表示数のレスポンシブ対応（画面幅に応じたフレキシブル表示）
- [x] useResponsiveBarsフックの実装（最小120px〜最大200px幅）
- [x] 包括的テストスイートの追加（10テストケース）
- [x] 強制改行機能の実装（コード譜エディタで任意の場所に改行挿入）
- [x] 改行マーカーのデータ構造設計とヘルパー関数実装
- [x] 改行マーカーの視覚的表示とエディタUI改善
- [x] 改行を考慮したコード譜表示ロジックの実装
- [x] ドラッグ&ドロップによるコード並び替え機能の実装
- [x] @dnd-kitライブラリを使用した高品質なDnD体験
- [x] SortableChordItemコンポーネントとグリッド対応レイアウト
- [x] ドラッグハンドルと視覚的フィードバックの実装
- [x] 0.5拍最小単位サポートの実装（0.5刻みでの柔軟な拍数設定）
- [x] ChordChartEditorでの拍数入力フィールド更新（step=0.5, min=0.5）
- [x] ChordChart表示での小数拍数フォーマット対応
- [x] 0.5拍サポートの包括的テストスイート追加（9テストケース）
- [x] コード譜表示UI/UXの大幅改善
- [x] 小節線の視認性向上（濃い色、太い線幅、適切な配置）
- [x] 小節間マージン削除でコンパクトな表示実現
- [x] セクション名の【】囲み表示と小さなサイズ調整
- [x] 小節最大幅340px設定とレスポンシブ対応強化
- [x] 最小幅を守りつつ最大数小節表示ロジック実装
- [x] 拍数表示削除によるシンプル化
- [x] コード編集画面でのinputフォーカス外れ問題修正（React key属性最適化）
- [x] 初期画面ウェルカム画面改善（インポート・Score Explorerボタン追加）
- [x] エクスポート時のカスタムファイル名機能（ExportDialogコンポーネント実装）
- [x] セクション複製機能の実装（📄 複製ボタンによる完全なセクションコピー）
- [x] 拍数記法を[]に変更してテンションコードとの競合を解決（E7(#9)[2]記法対応）
- [x] ChordChartEditorの大規模リファクタリング（780行→72行、3つのコンポーネントに分割）
- [x] コード追加時のroot自動設定機能（extractChordRoot関数によるルート音抽出）
- [x] rootプロパティでのb→♭正規化（将来のキー変更機能に向けたデータ統一）
- [x] オンコード機能の実装（Chord型のbase?プロパティ追加とparseOnChord関数実装）
- [x] オンコード表示機能（ChordChart表示での/ベース音表示）
- [x] オンコードのテキスト入力対応（C/E形式での一括入力・コピペ機能）
- [x] オンコード機能の包括的テスト追加（31テストケース）
- [x] コード入力UXの改善（入力中の表示とデータ分離、フォーカスアウト時パース）
- [x] オンコード入力時の表示問題解決（/E等が消えない表示の実現）
- [x] 空文字列入力時のCへのフォールバック問題解決
- [x] 拍数入力UXの改善（入力中の表示とデータ分離、フォーカスアウト時パース）
- [x] 拍数入力時の空文字列・無効値問題解決
- [x] 無効入力時の視覚的フィードバック機能実装（入力中の警告色表示）
- [x] コード名・拍数バリデーション関数の追加（オンコード対応含む）
- [x] 視覚的フィードバックの包括的テスト追加（10テストケース）
- [x] 無効入力時の保存防止機能実装（バリデーションエラー時の保存ブロックとユーザーフィードバック）
- [x] コード譜入力画面で、セクションを入れ替えられるようにしたい（ドラッグ&ドロップ機能実装）
- [x] キー選択を音楽的に適切な12キーに限定し、平行調（メジャー/マイナー）を表示
- [x] MainLayoutの大規模リファクタリング（450行→90行、Header・ScoreExplorer・MobileScoreExplorerに分割）
- [x] ScoreExplorerコンポーネントの統合（重複コード削除、isMobileプロパティによる分岐実装）
- [x] 移調機能の実装（キー変更時にコードも一緒に移調するかユーザーに確認）
- [x] 移調ユーティリティ関数の実装（音楽理論に基づく正確な移調計算）
- [x] キーごとの適切な音名選択機能（#と♭の使い分け、オンコード対応）
- [x] 移調確認ダイアログコンポーネントの実装（TransposeConfirmDialog）
- [x] 移調機能の包括的テストスイート追加（14テストケース）

## 完了済み高優先度タスク
- [x] 拍子に応じた小節拍数の修正（3/4拍子で3拍、4/4拍子で4拍など）
- [x] 初期状態を空のコード譜に変更（サンプル楽譜を削除）
- [x] サイドバーの開閉
- [x] 今Bpmが数字で表示されているだけだけど、⚪️の点滅などで視覚的にbpmがわかるようにしたいな
- [x] Sidebarの名前をScore Explorerにしたいな
- [x] 楽譜の新規作成ボタンはscore explorerの中にあるべき
- [x] 複数の楽譜をインポート・エクスポートするボタンはscore explorerにあるべき
- [x] Score Explorerで、複数の楽譜を選択し、一度にアクションできるようにしたい。アクションの内容は、削除とエクスポート
- [x] Gmail風の一括選択チェックボックスUIに変更
- [x] Score Explorerの横幅を拡張（320px）
- [x] アクションボタンをプルダウン式に統合
- [x] アクションボタンと選択件数表示の常時表示（未選択時はグレーアウト）
- [x] ボタンの色がガチャガチャしていて嫌なので、トンマナを策定してCLAUDE.mdに書いてほしいな
- [x] CLAUDE.mdに書かれたトンマナに合わせてUIの色味を変えてほしいな
- [x] いまは一段に表示する小節数が固定になっているけど、フレキシブルにしたいな〜
  - [x] 1小節の最小の横幅、最大の横幅を決めたい
  - [x] 画面が小さくなったときには最小の横幅が入るだけ一段に入れる
  - [x] 画面が大きくなったときには最大の横幅が入るぶんだけ一段に入れる
- [x] ユーザーがコード譜エディタで、任意の場所に楽譜のを強制改行を入れられるようにしたい
- [x] コード譜入力画面で、ドラッグアンドドロップでコードの入れ替えができるようにしたい
- [x] コードの拍数の最小単位が1だけど、0.5を最小単位としたい
- [x] 小節線が見えにくいので、色を濃くするなりなんなりで見やすくしたい
- [x] 小節の改行ごとに余計なマージンが取られているから、そのマージンを無くしたい
- [x] セクション名は【】で囲んで表示する。また、セクション名のサイズは小さくて良い
- [x] コード編集画面でinput変更時にフォーカスが外れる問題を修正
- [x] 初めて画面を開いたときに今は「新規作成」しかないけど、「インポート」「Score Explorerを開く」もボタンを用意しておきたいな
- [x] エクスポートするときファイル名をユーザーが決められるようにしたい
- [x] ヘッダが中途半端に中央よせしてあるのが気に食わない。左寄せでいい
- [x] コード譜入力画面で、コード進行をコピペできるようにしたいな
- [x] コード譜入力画面で、「コード追加」ボタンを、そのセクションの最後のコードの次（つまり次のコードが現れるであろうところ）に移動させたい
- [x] コード譜入力画面で、「セクション追加」ボタンを、セクションリストの最後のセクションとメモの間に移動させたい
- [x] コード譜入力画面で、shiftを押しながらコードの選択をすると範囲選択されるようにしたい
- [x] ChordChartEditor.tsxがかなり大きなファイルになってきているので、既存のふるまいを壊さないように慎重にリファクタリングする
- [x] コード編集画面の、「全選択」「全解除」「コピー」「貼り付け」「複製」ボタンが横に長すぎるので、アイコンだけ表示するようにしたい、テキストはマウスオーバーで出てくるといいな
- [x] コード編集画面の「全解除」ボタンをなくして、「全選択」ボタンを押すと以下の挙動をするようにしてほしい
  - すでに全てのコードが選択されている場合：全解除の挙動
  - 一部のコードが選択されている場合：全選択の挙動
  - ひとつもコードが選択されていない場合：全選択の挙動
- [x] faviconがトンマナに合っていないので、トンマナにあったものにしてほしいな。シンプルで抽象的なアイコンがいい
- [x] キーの選択プルダウンで、#だけじゃなくて♭も選択できるようにしたい
- [x] オンコードに対応したいな。コードの最後が`/[A-G][#♭b]`で終わるときはオンコードとみなしたい。Chord型に`base?`プロパティを追加して、コードをパースしたときにオンコードだったら`base?`に適切な値を入れて
- [x] コード譜入力画面で、セクションを入れ替えられるようにしたい
- [x] PWAで動いているときには画面をスリープさせたくない
- [x] いま、キーを選ぶ際"#"も"♭"もあるが、キーとして適切なものに限定したい。また、平行調も表示したい。つまり…
  - C/Am, D♭/B♭m, D/Bm, E♭/Cm, E/C#m, F/Dm, G♭/E♭m, G/Em, A♭/Fm, A/F#m, B♭/Gm, B/G#mにしたい
- [x] MainLayoutが肥大化してきているのでリファクタ。既存のふるまいをこわさないように慎重に行うこと。
- [x] ScoreExplorerとMobileScoreExplorerの重複コードを統合し、isMobileプロパティで分岐するように改善
- [x] 移調機能を作りたい
  - 楽譜自体のキーを変えるとき、「コードも一緒に移調しますか？」と尋ね、ユーザーが「はい」と言ったらコードも一緒に移調する。「いいえ」と言ったらコードはそのまま、キーだけ変更する
  - このとき、移調先に同名異音がある場合、一般的にそのキーで使われる音名を採用する。
    - 「一般的にそのキーで使われる音名」がわからない場合、CluadeCodeはユーザーに質問すること
- [x] データ構造が変化したときに、保存されているデータやインポートされるデータがちゃんとマイグレーショされる仕組みがほしいですね
  - マイグレーション機能は既に包括的に実装済み（migration.ts、chartMigration.ts、storage.ts）
  - 保存データの自動マイグレーション、インポート時のマイグレーション対応完了
  - 10件のテストケースが全てパス済み

## 完了済み中優先度タスク
- [x] エクスポート・インポート機能（JSONフォーマット）