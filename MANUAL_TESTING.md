# 手動テスト手順書

> 📋 **このドキュメントについて**  
> 自動化が困難または非効率な機能について、人間が実施すべきテスト手順をまとめています。  
> 新機能リリース前やメジャーアップデート前に実施してください。

## 📝 テスト実施のタイミング

- **必須実施**: メジャーリリース前（バージョン番号変更時）
- **推奨実施**: PWA機能・同期機能に変更があった時
- **定期実施**: 月1回程度の定期確認

---

## 🔄 Google Drive同期機能テスト

> **理由**: OAuth認証・実Google Driveアカウントが必要なため自動化困難

### 事前準備
- [ ] **ローカルストレージクリア**
  - [ ] 開発者ツール > Application > Local Storage > アプリのドメインを選択 > Clear All
  - [ ] 開発者ツール > Application > IndexedDB > localforage を削除
  - [ ] ページをリロードしてクリーンな状態を確認
- [ ] Google Driveアカウントでログイン済み
- [ ] テスト用の楽譜データを2-3件作成済み
- [ ] 2つ以上のデバイス（PC・スマホ等）またはブラウザ（Chrome・Safari等）準備

### テスト手順

#### 1. 基本同期フロー
- [ ] **認証テスト**
  - [ ] ヘッダーの同期ボタンをクリック
  - [ ] Google認証画面が正常に表示される
  - [ ] 認証完了後、同期ステータスが「認証済み」になる
- [ ] **手動同期テスト**
  - [ ] 「今すぐ同期」ボタンをクリック
  - [ ] 同期中のローディング表示が出る
  - [ ] 「同期完了」メッセージが表示される
  - [ ] Google Drive上にNekogataフォルダとJSONファイルが作成される

#### 2. 削除同期テスト（最重要）
- [ ] **デバイスA側の操作**
  - [ ] 楽譜を1件作成し、同期実行
  - [ ] デバイスBでも同期して、楽譜が表示されることを確認
- [ ] **デバイスA側で削除**
  - [ ] 作成した楽譜を削除
  - [ ] 同期を実行
- [ ] **デバイスB側で確認**
  - [ ] 同期を実行
  - [ ] 削除した楽譜が表示されない（復活しない）ことを確認
  - [ ] ⚠️ 現在このテストが失敗する可能性あり（既知のバグ）

#### 3. コンフリクト処理テスト
- [ ] **両デバイスで同じ楽譜を編集**
  - [ ] デバイスA: 楽譜のタイトルを「テスト楽譜A」に変更
  - [ ] デバイスB: 同じ楽譜のタイトルを「テスト楽譜B」に変更
  - [ ] 両デバイスで同期実行
- [ ] **コンフリクト確認**
  - [ ] エラーメッセージまたは適切な処理が行われる
  - [ ] データが破損していない

#### 4. ネットワークエラー処理
- [ ] **オフライン状態でのテスト**
  - [ ] ネットワークを切断
  - [ ] 同期ボタンをクリック
  - [ ] 適切なエラーメッセージが表示される
- [ ] **認証エラーテスト**
  - [ ] Google Driveで認証を取り消し
  - [ ] 同期実行時に再認証が促される

---

## 📱 PWA・オフライン機能テスト

> **理由**: ネットワーク状態制御、Service Worker等の自動化コストが高い

### 事前準備
- [ ] **ローカルストレージクリア**
  - [ ] 開発者ツール > Application > Local Storage > Clear All
  - [ ] 開発者ツール > Application > IndexedDB > localforage を削除
  - [ ] 開発者ツール > Application > Service Workers > Unregister（既存のService Workerがあれば）
- [ ] PWAがインストール可能なブラウザ（Chrome、Edge、Safari等）
- [ ] ネットワーク接続の制御ができる環境

### テスト手順

#### 1. PWAインストールテスト
- [ ] **インストール可能性確認**
  - [ ] ブラウザのアドレスバーにインストールアイコンが表示される
  - [ ] 「ホーム画面に追加」オプションが利用可能
- [ ] **インストール実行**
  - [ ] PWAをインストール
  - [ ] スタンドアロンアプリとして起動できる
  - [ ] アプリアイコンが適切に表示される

#### 2. オフライン機能テスト
- [ ] **基本オフライン動作**
  - [ ] オンライン状態で楽譜を2-3件作成・編集
  - [ ] ネットワーク接続を切断
  - [ ] アプリが正常に動作し続ける
  - [ ] 既存の楽譜が表示・編集できる
- [ ] **オフライン作成・編集**
  - [ ] オフライン状態で新しい楽譜を作成
  - [ ] コードの追加・編集・削除が正常に動作
  - [ ] 移調機能が正常に動作
  - [ ] セクションの追加・削除が正常に動作
- [ ] **ネットワーク復帰時の同期**
  - [ ] ネットワーク接続を復元
  - [ ] オフライン中の変更が保持されている
  - [ ] Google Drive同期が正常に実行できる

#### 3. Service Workerテスト
- [ ] **キャッシュ動作確認**
  - [ ] 開発者ツール > Application > Service Workers で登録確認
  - [ ] キャッシュストレージにリソースが保存されている
  - [ ] オフライン時もアプリのリソースが読み込める

---

## 💾 LocalForage永続化テスト

> **理由**: 詳細な永続化動作は実機での確認が重要

### 事前準備
- [ ] **ローカルストレージ完全クリア**
  - [ ] 開発者ツール > Application > Local Storage > Clear All
  - [ ] 開発者ツール > Application > IndexedDB > localforage を削除
  - [ ] 開発者ツール > Application > Session Storage > Clear All
  - [ ] ページをリロードしてクリーンな状態を確認

### テスト手順

#### 1. 基本永続化テスト
- [ ] **複雑なチャート作成**
  - [ ] 楽譜を1件作成（タイトル: 「永続化テスト」）
  - [ ] セクションを3つ追加（イントロ・Aメロ・サビ）
  - [ ] 各セクションに4-8個のコードを追加
  - [ ] メモ欄にテキストを入力
- [ ] **リロード後の復元確認**
  - [ ] ブラウザをリロード（F5またはCmd+R）
  - [ ] 作成した楽譜が正確に復元される
  - [ ] 全セクション・コード・メモが保持されている
  - [ ] 最後に開いていた楽譜が表示される

#### 2. 複数チャート永続化テスト
- [ ] **大量データ作成**
  - [ ] 楽譜を5-10件作成
  - [ ] 各楽譜で移調を数回実行
  - [ ] 一部楽譜を削除
- [ ] **セッション継続性確認**
  - [ ] ブラウザタブを閉じる
  - [ ] 新しいタブでアプリを開く
  - [ ] 全ての変更が正確に保持されている

#### 3. エラー耐性テスト
- [ ] **ストレージ制限テスト**
  - [ ] 大量の楽譜（20件以上）を作成
  - [ ] 各楽譜に長いメモを追加
  - [ ] 適切にエラーハンドリングされる
- [ ] **データ整合性確認**
  - [ ] 開発者ツール > Application > Local Storage確認
  - [ ] データが破損していない
  - [ ] 不正なデータがあってもアプリが動作する

---

## ✅ テスト実施チェックリスト

### リリース前必須チェック
- [ ] Google Drive同期機能テスト（削除同期を重点的に）
- [ ] PWAインストール・オフライン基本動作テスト
- [ ] LocalForage基本永続化テスト

### 定期実施推奨
- [ ] Google Drive同期のコンフリクト処理テスト
- [ ] PWA Service Workerテスト
- [ ] LocalForage大量データ・エラー耐性テスト

---

## 🚨 既知の問題・注意事項

### Google Drive同期
- **削除同期バグ**: 現在、デバイス間での楽譜削除が正しく同期されない場合がある
- **認証期限**: 1時間ごとに再認証が必要（今後改善予定）

### PWA機能
- **Safari制限**: iOSのSafariでは一部PWA機能に制限がある
- **キャッシュサイズ**: 大量のデータでキャッシュ制限に達する可能性

### LocalForage
- **ブラウザ制限**: プライベートモードでは永続化されない
- **容量制限**: ブラウザごとに異なる容量制限がある

---

## 📞 問題発生時の対応

1. **テスト失敗時**: GitHub Issuesに詳細を報告
2. **データ消失時**: ブラウザの開発者ツールでLocal Storageを確認
3. **同期エラー時**: Google Drive認証状態とネットワーク接続を確認