# TODO

> 📝 **運用ルール**: 
> - 完了したタスクは即座に [TODO_DONE.md](./TODO_DONE.md) に移動する
> - タスクを完了したらすぐに該当行を削除してTODO_DONE.mdに追記する
> 
> 🤖 **Claude Codeとの作業について**:
> - **TODO.md**: プロジェクト全体の長期的な課題・機能要望を管理（人間が手動管理）
> - **TodoWrite/TodoReadツール**: Claude Codeのセッション内でのタスク管理（自動管理）
>   - 複雑な作業（3ステップ以上）を整理する際に使用
>   - リアルタイムな進捗管理（pending → in_progress → completed）
>   - セッション終了時に自動的にクリア
> - 使い分けの例：
>   - TODO.md: 「削除同期バグを修正する」（長期的な課題）
>   - TodoWriteツール: その実装時の詳細ステップ管理

## 開発予定の機能

### 🚀 サクッと片付け優先（重い作業の合間に）

- [ ] **モバイルデバイスでのドラッグアンドドロップ動作確認** (推定工数: 30分)
  - **背景**: TouchSensorを追加し250ms遅延を設定したが、実機での動作確認が必要
  - **確認項目**:
    - [ ] スマートフォンでセットリスト・コード譜のドラッグアンドドロップが動作するか
    - [ ] 通常のスクロールと区別できているか
    - [ ] 250msの遅延は適切か（長すぎ/短すぎないか）
  - **注意**: E2Eテストで3件失敗しているが、実機動作優先で対応

### 🔴 高優先度

*現在該当タスクなし*

### 🟡 中優先度

- [x] **E2Eテスト品質向上** (推定工数: 1日) ✅ 2025-06-28完了
  - [x] ハードコード待機(waitFor())をwaitFor条件ベースに変更
  - 注: ドラッグ&ドロップのアニメーション待機（500ms）は技術的制約により残存

- [ ] **楽譜共有リンク機能** (推定工数: 3-4日)
  - **背景**: バンドメンバー間での楽譜共有を簡単にしたい（LINEやメール等で手軽に送信）
  - **技術方針**: Dropbox公開共有方式（既存同期インフラ活用、バックエンドレス維持）
  - **重要**: 現在のスコープでは実装不可。`sharing.write`と`sharing.read`の追加が必須
  - **必要な変更**:
    - [ ] Dropbox認証スコープに`sharing.write sharing.read`を追加
    - [ ] 既存ユーザーへの再認証案内UI実装
  - **実装タスク**:
    - [ ] DropboxSyncAdapter拡張（公開ファイルアップロード対応）
    - [ ] Score Explorerに「楽譜を共有」ボタン追加
    - [ ] 共有リンク生成ダイアログ（URL表示・コピー機能）
    - [ ] 共有URLのクエリストリング解析機能
    - [ ] Dropbox公開ファイル取得（認証不要、`?dl=1`パラメータ使用）
    - [ ] インポート確認ダイアログ（楽譜プレビュー付き）


### 🟢 低優先度
- [ ] **Dropbox同期機能のユーザー公開** (推定工数: 30分)
  - **前提条件**: 削除同期修正、手動テストプロセス確立が完了済み、アクセストークンリフレッシュ機能実装済み
  - **現状**: ✅ Google DriveからDropboxへの移行完了
  - **内容**: フィーチャーフラグ（隠しコマンド）を外して同期機能を一般ユーザーに公開
  - **変更ファイル**: `src/hooks/useHiddenFeatures.ts` の `syncSettings` を `true` に変更
  - **影響**: ヘッダーの同期ステータスインジケータと同期設定ボタンが全ユーザーに表示される

- [ ] **起動時自動同期の詳細UX改善** (推定工数: 1.5-2日)
  - **現状**: ❌ 起動時自動同期は未実装（初期化のみで同期実行なし）
  - **背景**: アプリ起動時に最新データを自動取得してユーザビリティ向上
  - **優先度変更理由**: ヘッダーからの手動同期が簡単になったため、自動同期の必要性が大幅に低下
  - **実装計画**:
    - [ ] Phase 1: 起動時同期の基本実装
      - [ ] `useChartSync`の初期化時に同期実行を追加
      - [ ] 同期設定に`syncOnStartup`フラグを追加（デフォルト: true）
      - [ ] 認証済み＋syncOnStartup有効時のみ起動時同期を実行
    - [ ] Phase 2: ローディングUI改善
      - [ ] 起動時同期専用の`isInitialSyncing`状態を追加
      - [ ] ヘッダーに起動時同期中の表示を追加（「データを同期中...」）
      - [ ] 同期完了/エラー時のトースト通知
    - [ ] Phase 3: エラーハンドリング強化
      - [ ] ネットワークエラー時の自動リトライ（最大3回）
      - [ ] オフライン時は同期をスキップ
      - [ ] エラー時もアプリは使用可能に（グレースフルデグレード）
  - **起動時の定義**: コンポーネント初回マウント時（ページ読み込み・リロード・PWA起動）
- [ ] **コード譜の検索・フィルタリング機能** (推定工数: 1-2日)
- [ ] **PWAアイコンの作成・設定** (推定工数: 1時間)
- [ ] **エクスポート機能（PDF、テキスト等）** (推定工数: 2-3日)
- [ ] **コード譜のバックアップ・復元機能** (推定工数: 1-2日)
- [ ] **オフライン対応の詳細実装** (推定工数: 2-3日)
- [ ] **ダークモード対応** (推定工数: 1日)
- [ ] **楽器別表示設定** (推定工数: 2日)


### あえてやらない
- [ ] **GitHub Actions E2Eテスト自動化** (推定工数: 1日)
  - [ ] GitHub Actions での E2E テスト自動実行設定
  - [ ] Pull Request での E2E テスト必須化
  - なぜならば、E2Eテストはコストが高いので、手元でやることにしているから


---

## 📋 手動テスト項目

詳細手順は **[MANUAL_TESTING.md](./MANUAL_TESTING.md)** を参照
- Dropbox同期テスト手順（認証・削除同期・コンフリクト処理）
- PWA・オフライン機能テスト手順
- LocalForage永続化テスト手順
- リリース前チェックリスト

---

## 📈 開発状況

- **完了済みタスク**: [TODO_DONE.md](./TODO_DONE.md) を参照
- **現在の最優先**: 起動時自動同期のUX改善とDropbox同期機能の一般公開
- **E2Eテスト基盤**: ✅ 音楽アプリのコア機能100%カバー達成（B評価）
- **Dropbox同期機能**: ✅ 基本実装完了・OAuth PKCE・リフレッシュトークン対応済み（フィーチャーフラグで非公開状態）