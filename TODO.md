# TODO

> 📝 **運用ルール**: 
> - 完了したタスクは即座に [TODO_DONE.md](./TODO_DONE.md) に移動する
> - タスクを完了したらすぐに該当行を削除してTODO_DONE.mdに追記する
> 
> 🤖 **Claude Codeとの作業について**:
> - **TODO.md**: プロジェクト全体の長期的な課題・機能要望を管理（人間が手動管理）
> - **TodoWrite/TodoReadツール**: Claude Codeのセッション内でのタスク管理（自動管理）
>   - 複雑な作業（3ステップ以上）を整理する際に使用
>   - リアルタイムな進捗管理（pending → in_progress → completed）
>   - セッション終了時に自動的にクリア
> - 使い分けの例：
>   - TODO.md: 「削除同期バグを修正する」（長期的な課題）
>   - TodoWriteツール: その実装時の詳細ステップ管理

## 開発予定の機能

### 🚀 サクッと片付け優先（重い作業の合間に）

> ✅ **2025-06-18完了**: 全サクッと片付けタスクが完了しました！

### 🔴 高優先度

- [ ] **削除操作の同期修正** (推定工数: 2-3日)
  - **背景**: 現在の同期実装では楽譜削除が正しく同期されない重要なバグが存在
  - **問題**: SyncManager.mergeCharts()で削除されたチャートがリモートから復活してしまう
  - **原因**: 削除されたチャートはlocalCharts配列に含まれないため、リモートの古いデータがマージ時に残存
  - [ ] Phase 1: 削除追跡システム実装
    - [ ] 削除されたチャートIDをローカルストレージで記録する仕組み追加
    - [ ] deletedChartIds配列をSyncManagerの同期処理に統合
    - [ ] ChartCrudStoreの削除メソッドで削除記録を更新
  - [ ] Phase 2: 同期ロジック修正
    - [ ] SyncManager.sync()で削除リストも含めて処理するよう修正
    - [ ] mergeCharts()で削除されたチャートを除外するロジック追加
    - [ ] GoogleDriveSyncAdapterで削除情報の永続化対応
  - [ ] Phase 3: テスト・検証
    - [ ] 削除同期のE2Eテスト実装（デバイス間削除検証）
    - [ ] 削除コンフリクト処理のテスト追加
    - [ ] 実機での削除同期動作確認

- [ ] **同期機能のユーザー公開** (推定工数: 30分)
  - **前提条件**: 削除同期修正、手動テストプロセス確立が完了済み
  - **内容**: フィーチャーフラグ（隠しコマンド）を外して同期機能を一般ユーザーに公開
  - **変更ファイル**: `src/hooks/useHiddenFeatures.ts` の `syncSettings` を `true` に変更
  - **影響**: ヘッダーの同期ステータスインジケータと同期設定ボタンが全ユーザーに表示される

### 🟡 中優先度

- [ ] **E2Eテスト品質向上** (推定工数: 1-2日)
  - [ ] ハードコード待機(waitFor(2000))をwaitFor条件ベースに変更
  - [ ] エラーハンドリングテスト追加(ネットワークエラー、バリデーションエラー等)
  - [ ] GitHub Actions での E2E テスト自動実行
  - [ ] Pull Request での E2E テスト必須化


- [ ] **起動時自動同期の実装** (推定工数: 1-2日)
  - **背景**: ユーザビリティ向上のため、アプリ起動時に自動で最新データを同期したい
  - [ ] useChartSyncに起動時同期フラグとロジック追加
  - [ ] 初期データロード完了後の自動同期トリガー実装
  - [ ] 起動時同期中のローディング表示（ヘッダー等）
  - [ ] 起動時同期の設定ON/OFF機能追加

- [ ] **アクセストークンの自動リフレッシュ機能実装** (推定工数: 3-5日)
  - **背景**: 現在のImplicit Flow実装では1時間ごとに再認証が必要でUX悪化
  - [ ] Authorization Code Flow + PKCE実装
  - [ ] リフレッシュトークンの取得・永続化機能実装
  - [ ] `refreshAccessToken()`メソッド実装
  - [ ] 長期間利用可能な認証状態（リフレッシュトークンで最大6ヶ月）

- [ ] **楽譜共有リンク機能** (推定工数: 3-4日)
  - **背景**: バンドメンバー間での楽譜共有を簡単にしたい（LINEやメール等で手軽に送信）
  - **技術方針**: Google Drive公開共有方式（既存同期インフラ活用、バックエンドレス維持）
  - [ ] GoogleDriveSyncAdapter拡張（公開ファイルアップロード対応）
  - [ ] Score Explorerに「楽譜を共有」ボタン追加
  - [ ] 共有リンク生成ダイアログ（URL表示・コピー機能）
  - [ ] 共有URLのクエリストリング解析機能
  - [ ] Google Drive公開ファイル取得（認証不要）
  - [ ] インポート確認ダイアログ（楽譜プレビュー付き）

### 🟢 低優先度
- [ ] Score Explorerの楽譜一覧のソート機能を作りたい(名前、作成日時、更新日時それぞれに対して昇順、降順)
- [ ] コード譜の検索・フィルタリング機能
- [ ] PWAアイコンの作成・設定
- [ ] エクスポート機能（PDF、テキスト等）
- [ ] コード譜のバックアップ・復元機能
- [ ] オフライン対応の詳細実装
- [ ] ダークモード対応
- [ ] 楽器別表示設定

---

## 📋 手動テスト項目

詳細手順は **[MANUAL_TESTING.md](./MANUAL_TESTING.md)** を参照
- Google Drive同期テスト手順（認証・削除同期・コンフリクト処理）
- PWA・オフライン機能テスト手順
- LocalForage永続化テスト手順
- リリース前チェックリスト

---

## 📈 開発状況

- **完了済みタスク**: [TODO_DONE.md](./TODO_DONE.md) を参照
- **現在の最優先**: 削除同期バグ修正（実ユーザー体験に直結）
- **E2Eテスト基盤**: ✅ 音楽アプリのコア機能100%カバー達成（B評価）
- **Google Drive同期機能**: ✅ 実装完了（削除同期バグを除く）